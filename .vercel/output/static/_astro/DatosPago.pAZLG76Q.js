import{j as e}from"./jsx-runtime.D5qyYPMi.js";import{c as T}from"./calcularCostoDeEnvio.6gq9u7_a.js";import{c as U}from"./calcularPago.CQuJdh9u.js";import{f as z}from"./calcularDescuento.CXg88ned.js";import{r as s}from"./index.CZlPm10g.js";import{a as D}from"./axios.C8DqakIB.js";import{T as B}from"./Toast.ClEPDOpx.js";import{M as P}from"./Modal.BWYwa0w5.js";import"./ThemeProvider.C_HRE9zQ.js";import"./index.DmcuHbSi.js";import"./index.CFq_IdT0.js";var k={};Object.defineProperty(k,"__esModule",{value:!0});var J=k.loadMercadoPago=void 0;const R="https://sdk.mercadopago.com/js/v2",G=/^https:\/\/sdk\.mercadopago\.com\/js\/v2\/?(\?.*)?$/,C="MercadoPago has already been initialized in your window, please remove the duplicate import",K="MercadoPago.js not available",q="Failed to load MercadoPago.js",H=()=>{for(var a=document.querySelectorAll(`script[src^="${R}"`),o=0;o<a.length;o++){var t=a[o];if(G.test(t.src))return t}return null},X=()=>{const a=document.createElement("script");a.src=R;const o=document.head||document.body;if(!o)throw new Error("Expected document.body or document.head not to be null. MercadoPago requires a <body> or a <head> element, please add on your project.");return o.appendChild(a),a};let y=null;const V=()=>(y!==null||(y=new Promise((a,o)=>{if(typeof window>"u"){a(null);return}if(window.MercadoPago){console.warn(C),a(window.MercadoPago);return}try{let t=H();t?console.warn(C):t||(t=X()),t.addEventListener("load",()=>{window.MercadoPago?a(window.MercadoPago):o(new Error(K))}),t.addEventListener("error",()=>{o(new Error(q))})}catch(t){o(t);return}})),y);J=k.loadMercadoPago=V;var W=function(a,o,t,n){function i(l){return l instanceof t?l:new t(function(r){r(l)})}return new(t||(t=Promise))(function(l,r){function p(u){try{d(n.next(u))}catch(m){r(m)}}function f(u){try{d(n.throw(u))}catch(m){r(m)}}function d(u){u.done?l(u.value):i(u.value).then(p,f)}d((n=n.apply(a,o||[])).next())})};class w{static getInstance(){return W(this,void 0,void 0,function*(){if(this.publicKey)return this.loadedInstanceMercadoPago||(yield J(),this.loadedInstanceMercadoPago=!0),this.instanceMercadoPago||(this.instanceMercadoPago=new window.MercadoPago(this.publicKey,this.options)),this.instanceMercadoPago;console.error("Expected the PUBLIC_KEY to render the MercadoPago SDK React")})}}w.publicKey=null;w.options={};w.instanceMercadoPago=void 0;w.loadedInstanceMercadoPago=!1;function Y(a,o){return Object.keys(a).length===Object.keys(o).length&&Object.keys(a).every(n=>Object.prototype.hasOwnProperty.call(o,n)&&a[n]===o[n])}const Z=(a,o)=>{const t=Object.assign(Object.assign({},o),{frontEndStack:"react"}),n=!Y(w.options,t);(a!==w.publicKey||n)&&(w.publicKey=a,w.options=t,w.instanceMercadoPago=void 0)},$="http://localhost:3000",A=async({productos:a,datos:o,ruta:t,valorDeEnvio:n})=>{try{return await D.post(`${$}/finish/${t}`,{datos:o,valorDeEnvio:n,productos:a})}catch(i){throw i}},F=async({productos:a,datos:o,ruta:t,valorDeEnvio:n})=>{try{return await D.post(`${$}/finish/${t}`,{datos:o,valorDeEnvio:n,productos:a})}catch(i){throw i}},Q="APP_USR-2193020481597360-031710-0bee27470d953c084f41b012ac5383b1-510451985",ee="mercadopago-user",te="mercadopago-invited",oe=({isAuthenticated:a})=>{const[o,t]=s.useState(!1),[n,i]=s.useState(null),[l,r]=s.useState(),[p,f]=s.useState([]),[d,u]=s.useState(),[m,b]=s.useState(""),[h,g]=s.useState(!1),[S,v]=s.useState("");Z(Q,{locale:"es-CO"}),s.useEffect(()=>{let c=JSON.parse(localStorage.getItem("carrito")||"[]"),x=JSON.parse(localStorage.getItem("dataUserForBuy")||""),L=JSON.parse(localStorage.getItem("infoProfileUSer")||"{}"),O=JSON.parse(localStorage.getItem("referenceDataLocation")||"");u(O),i(x),r(L),f(c)},[]);const N={...n,...l,...d},M={...n,...d},I=U(p),E=n?.destino||"0",j=T({destino:E,precio:I}),_=async()=>{try{if(!p||!n||p.length===0){b("Faltan algunos datos, verifica eh intentalo de nuevo"),v("toast-fail"),g(!0),setTimeout(()=>g(!1),3e3),t(!1);return}if(t(!0),a){const c=await F({productos:p,datos:N,ruta:ee,valorDeEnvio:j});if(c.status===200){const{init_point:x}=c.data;window.location.href=x,localStorage.removeItem("dataUserForBuy"),localStorage.removeItem("carrito")}}else{const c=await F({productos:p,datos:M,ruta:te,valorDeEnvio:j});if(c.status===200){const{init_point:x}=c.data;window.location.href=x,localStorage.removeItem("dataUserForBuy"),localStorage.removeItem("carrito")}}}catch(c){console.log(c),b("No pudimos procesar tu compra, por favor intentalo de nuevo o intentalo despues"),v("toast-fail"),setTimeout(()=>g(!1),3e3),g(!0)}finally{t(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(B,{showToast:h,setShowToast:g,toastMessage:m,setToastMessage:b,bgToast:S,setBgToast:v}),e.jsxs("div",{className:"flex flex-col items-center justify-center mb-3 ",children:[e.jsx("button",{className:"border flex py-2 px-4 items-center gap-1 rounded-md bg-[#009ee3] text-white hover:bg-[#0049e5ef] duration-100",onClick:_,children:o?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:"../../../mercadopago.webp",alt:"logo de mercadopago",className:"size-7"}),"Estamos procesando tu pago..."]}):e.jsxs(e.Fragment,{children:[e.jsx("img",{src:"../../../mercadopago.webp",alt:"logo de mercadopago",className:"size-7"}),"Pagar con Mercado Pago"]})}),e.jsx("span",{className:"text-gray-500 text-xs mt-1",children:"Paga de forma segura"})]})]})},ae="buy-user",ne="buy-invited",se=({isAuthenticated:a})=>{const[o,t]=s.useState(!1),[n,i]=s.useState(""),[l,r]=s.useState(!1),[p,f]=s.useState(""),[d,u]=s.useState([]),[m,b]=s.useState(),[h,g]=s.useState(null),[S,v]=s.useState();s.useEffect(()=>{let c=JSON.parse(localStorage.getItem("referenceDataLocation")||""),x=JSON.parse(localStorage.getItem("carrito")||"[]"),L=JSON.parse(localStorage.getItem("dataUserForBuy")||""),O=JSON.parse(localStorage.getItem("infoProfileUSer")||"{}");g(L),b(c),v(O),u(x)},[]),console.log(m);const N={...h,...S,...m},M={...h,...m},I=h?.destino||"0",E=U(d),j=T({destino:I,precio:E}),_=async()=>{if(sessionStorage.setItem("carrito",JSON.stringify(d)),sessionStorage.setItem("dataUserForBuy",JSON.stringify(h)),t(!0),!h){i("Faltan los datos de envío, por favor verificar antes de continuar."),f("toast-fail"),r(!0),setTimeout(()=>r(!1),3e3),t(!1);return}if(!d||d.length===0){i("No hay productos en el carrito."),f("toast-fail"),r(!0),setTimeout(()=>r(!1),3e3),t(!1);return}try{if(a){const c=await A({productos:d,datos:N,ruta:ae,valorDeEnvio:j});c.status===200&&(window.location.href=`/success/${c.data.message}`,localStorage.removeItem("carrito"),localStorage.removeItem("steps"))}else{const c=await A({productos:d,datos:M,ruta:ne,valorDeEnvio:j});c.status===200&&(window.location.href=`/success/${c.data.message}`,localStorage.removeItem("carrito"),localStorage.removeItem("steps"))}}catch(c){if(D.isAxiosError(c)&&c.response){const{status:x}=c.response;x===400?(f("fail"),r(!0),i("Algo salio mal con tu compra, intentalo de nuevo"),setTimeout(()=>{r(!1)},5e3)):x===500&&(f("fail"),r(!0),i("No pudidos proceder con tu compra"),setTimeout(()=>{r(!1)},5e3))}}finally{t(!1)}};return e.jsxs("div",{children:[e.jsx(B,{showToast:l,setShowToast:r,toastMessage:n,setToastMessage:i,bgToast:p,setBgToast:f}),e.jsxs("p",{className:"text-sm md:text-base font-semibold mb-2 flex items-center gap-1 ",children:["Por favor tenga en cuenta lo siguiente",e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"icon icon-tabler icon-tabler-exclamation-circle size-6",width:"44",height:"44",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"#2c3e50",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),e.jsx("path",{d:"M12 12m-9 0a9 9 0 1 0 18 0a9 9 0 1 0 -18 0"}),e.jsx("path",{d:"M12 9v4"}),e.jsx("path",{d:"M12 16v.01"})]})]}),e.jsxs("ul",{className:"text-sm mb-3 pl-6",children:[e.jsx("li",{className:"mb-2 list-disc  text-balance",children:"En caso de no poder recibir la compra, por favor deje a alguien encargado para que la reciba por usted."}),e.jsx("li",{className:"mb-2 list-disc text-balance",children:"Al momento de recibir su compra tenga en cuanta que el pago debe ser en efectivo."}),e.jsxs("li",{className:" list-disc text-balance",children:["Si tiene dudas sobre el metodo de pago seleccionado, antes de continuar lo invitamos a consultar la pagina de ",e.jsx("a",{href:"/Medios-de-pago",className:"text-blue-500 font-semibold",children:" metodos de pago"})]})]}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx("button",{className:"bg-blue-600 py-2 text-sm rounded-md text-white hover:bg-blue-700 duration-100",onClick:_,children:o?e.jsx("p",{children:"Procesando pago..."}):"Continuar con esta forma de pago"})})]})},ce=({isAuthenticated:a})=>{const[o,t]=s.useState(!1),n=()=>t(!1),i=()=>t(!0);return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center justify-center",children:[e.jsxs("button",{onClick:i,className:" bg-blue-500 w-[95%] md:max-w-[39%] mx-auto flex items-center justify-center gap-1  py-2.5 px-4 rounded-md text-white duration-200 hover:bg-blue-600 ",children:[e.jsx("span",{className:"bg-white inline-flex rounded-full p-1",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"icon icon-tabler icon-tabler-home-dollar size-4",width:"44",height:"44",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"#2c3e50",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{stroke:"none",d:"M0 0h24v24H0z",fill:"none"}),e.jsx("path",{d:"M19 10l-7 -7l-9 9h2v7a2 2 0 0 0 2 2h6"}),e.jsx("path",{d:"M9 21v-6a2 2 0 0 1 2 -2h2c.387 0 .748 .11 1.054 .3"}),e.jsx("path",{d:"M21 15h-2.5a1.5 1.5 0 0 0 0 3h1a1.5 1.5 0 0 1 0 3h-2.5"}),e.jsx("path",{d:"M19 21v1m0 -8v1"})]})}),"Pagar al recibir"]}),e.jsx("span",{className:"text-gray-500 text-xs mt-1",children:"Paga en la puerta de tu casa"})]}),o&&e.jsx("div",{id:"box-backdrop",className:"fixed inset-0 bg-gray-900/50 z-40"}),e.jsxs(P,{show:o,onHide:n,children:[e.jsx(P.Header,{closeButton:!0,className:"border-none pt-4 pb-1 px-4"}),e.jsx("div",{className:"font-font-cust-2 p-2",children:e.jsxs(P.Body,{className:"pt-0",children:[e.jsx(se,{isAuthenticated:a}),e.jsx("button",{className:"mt-2 text-sm w-full bg-[#ebebeb] py-2 px-4 rounded-md hover:bg-[#d5d5d5] duration-100",onClick:()=>t(!1),children:"Cambiar el metodo de pago"})]})})]})]})},we=({isAuthenticated:a})=>{const[o,t]=s.useState(),[n,i]=s.useState([]),[l,r]=s.useState();s.useEffect(()=>{const b=JSON.parse(localStorage.getItem("dataUserForBuy")||"[]"),h=JSON.parse(localStorage.getItem("infoProfileUSer")||"[]"),g=JSON.parse(localStorage.getItem("carrito")||"[]");t(b),r(h),i(g)},[]);const p=o?.destino||"0",f=U(n),d=T({destino:p,precio:f}),u=(f+d).toString(),m=z(u);return e.jsxs("div",{className:"flex flex-col py-1",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-evenly",children:[e.jsxs("div",{className:"flex flex-col border-dashed border-2 py-3 px-4",children:[e.jsx("h3",{className:"font-semibold text-xs md:text-sm uppercase bg-[#e3e3e3] py-1 px-2 mb-1",children:"Datos de usuario"}),e.jsxs("span",{className:"text-xs md:text-sm flex gap-1 flex-col pl-1",children:[e.jsx("strong",{children:"Nombre:"}),o?.nombre||l?.nombre]}),e.jsxs("span",{className:"text-xs md:text-sm flex gap-1 flex-col pl-1",children:[e.jsx("strong",{children:"Correo:"}),o?.email||l?.email]}),e.jsxs("span",{className:"text-xs md:text-sm flex gap-1 flex-col pl-1",children:[e.jsx("strong",{children:"Telefono:"}),o?.telefono||l?.telefono]})]}),e.jsxs("div",{className:"flex flex-col border-dashed border-2 py-3 px-4",children:[e.jsx("h3",{className:"font-semibold text-xs md:text-sm uppercase bg-[#e3e3e3] py-1 px-2 mb-1",children:"Datos de envio"}),e.jsxs("span",{className:"text-xs md:text-sm flex flex-col pl-1",children:[e.jsx("strong",{children:"Direccion:"}),o?.direccion]}),e.jsxs("span",{className:"text-xs md:text-sm flex flex-col pl-1 text-balance",children:[e.jsx("strong",{children:"Detalles:"}),o?.detalles]})]}),e.jsxs("div",{className:"flex flex-col border-dashed border-2 py-3 px-4 min-w-[200px]",children:[e.jsx("h3",{className:"font-semibold text-xs md:text-sm uppercase bg-[#e3e3e3] py-1 px-2 mb-1",children:" Total a pagar"}),e.jsxs("span",{className:"font-semibold text-center ",children:[" $: ",m]})]})]}),e.jsxs("div",{className:"w-[90%] mx-auto mt-3",children:[e.jsx("h3",{className:"font-semibold text-xs md:text-sm uppercase text-center bg-[#e3e3e3] py-1 px-2 mb-1",children:"Medios de pago"}),e.jsxs("p",{className:"text-xs md:text-sm pt-3 text-wrap  mb-4",children:["Para que tengas total confianza al pagar tus compras, ponemos a tu disposición estas dos opciones de pago. Asegúrate de revisar los términos de cada opción en nuestra página de ",e.jsx("a",{href:"/Medios-de-pago",className:"text-sm font-semibold text-blue-600 hover:text-blue-500 duration-150",children:"Medios de pago"}),"."]}),e.jsx(oe,{isAuthenticated:a}),e.jsx(ce,{isAuthenticated:a})]})]})};export{we as default};
